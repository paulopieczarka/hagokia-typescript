class t{width=800;height=600;static fromHTMLCanvas(e){const{width:s,height:i}=e,r=new t(s,i),o=()=>{e.width=window.innerWidth,e.height=window.innerHeight,r.onWindowResize()};return window.addEventListener("resize",o.bind(this)),o(),r}useCamera(t){return this.camera=t,this}constructor(t,e){this.width=t,this.height=e}onWindowResize(){this.width=window.innerWidth,this.height=window.innerHeight}}class e{constructor(t,e){this.canvas=t,this.ctx=e}save(){return this.ctx.save(),this}restore(){return this.ctx.restore(),this}translate(t,e){return this.ctx.translate(t,e),this}rotate(t){return this.ctx.rotate(t),this}color(t){return this.ctx.fillStyle=t,this}rect(t,e,s,i){return this.ctx.fillRect(t,e,s,i),this.ctx.resetTransform(),this}}class s{static TILE_SIZE=32}class i{constructor(t=0,e=0){this.x=t,this.y=e}follow(t){this.target=t}update(t,e,s){this.centerTargetIfExists(s)}centerTargetIfExists(t){if(!this.target)return;const{x:e,y:i}=this.target.get("Placeable");this.x=-e*s.TILE_SIZE+t.width/2,this.y=-i*s.TILE_SIZE+t.height/2}}class r{static sequence=0;constructor(t="Entity"){this.name=t,this.id=r.sequence++,this.components=[]}is(t){const e=this.getKey(t);this.components[e]=t}isNot(t){const e=this.getKey(t);delete this.components[e]}get(t){return this.components[t]}getComponentIds(){return Object.keys(this.components)}isDrawable(){return Boolean(Object.values(this.components).find((t=>"isDrawable"in t)))}getKey(t){return t.id}}class o{constructor(t){this.id=t}}class n extends o{constructor(t=0,e=0){super("Placeable"),this.x=t,this.y=e}set(t,e){this.x=t,this.y=e}}class a extends o{constructor(t="hotpink"){super("Colorable"),this.color=t}}class c extends o{isDrawable=!0}class h extends c{constructor(t,e){super("Shape"),this.width=t*s.TILE_SIZE,this.height=e*s.TILE_SIZE}}class l extends h{constructor(){super(1,1)}}class u extends o{constructor(){super("Player")}}class d extends c{constructor(){super("Tile")}}class g extends c{constructor(){super("Solid")}}class T extends r{static create(t="Player"){const e=new T(t);return e.is(new n(1,1)),e.is(new a("green")),e.is(new l),e.is(new u),e}constructor(t){super(t)}}class p extends r{static create(t,e){const s=new p;return s.is(new d),s.is(new h(1,1)),s.is(new n(t,e)),s}constructor(){super("Tile")}}class m extends p{static SIZE=32;static create(t,e){const s=p.create(t,e);return s.is(new a("hotpink")),s}}class w extends p{static SIZE=32;static create(t,e){const s=p.create(t,e);return s.is(new a("blue")),s.is(new g),s}}class O{static for(t){return new O(t)}render(t,e){}update(t,e,s){}shouldRun(){const t=this.entity.getComponentIds();return e=t,s=this.requires,JSON.stringify(e.sort())===JSON.stringify(s.sort())?this:null;var e,s}get requires(){return[]}constructor(t){this.entity=t}}class E extends O{static for(t){return new E(t)}render(t,e){const i=this.getColor(),{x:r,y:o}=this.getPosition(),{width:n,height:a}=this.getSizes(),c=r*s.TILE_SIZE+t.camera?.x,h=o*s.TILE_SIZE+t.camera?.y;e.color(i).translate(c,h).rect(0,0,n,a)}get requires(){return["Placeable","Shape"]}getColor(){return this.entity.get("Colorable")?.color||"white"}getPosition(){return this.entity.get("Placeable")}getSizes(){return this.entity.get("Shape")}}class f extends O{static for(t){return new f(t)}update(t,e,s){}get requires(){return["Placeable","Movable","Player"]}}class x{static getRandomRoom(t){const e=x[t||"rooms"];console.log(t,e);const s=e.length-1;return e[Math.round(Math.random()*s)]}static get top(){return[x.TOP,x.TOP_LEFT,x.TOP_RIGHT,x.TOP_BOTTOM]}static get bottom(){return[x.BOTTOM,x.BOTTOM_LEFT,x.BOTTOM_RIGHT,x.TOP_BOTTOM]}static get left(){return[x.LEFT,x.TOP_LEFT,x.BOTTOM_LEFT,x.LEFT_RIGHT]}static get right(){return[x.RIGHT,x.TOP_RIGHT,x.BOTTOM_RIGHT,x.LEFT_RIGHT]}static get rooms(){return[x.CENTER,x.LEFT,x.RIGHT,x.TOP,x.BOTTOM,x.TOP_LEFT,x.TOP_RIGHT,x.TOP_BOTTOM,x.BOTTOM_LEFT,x.BOTTOM_RIGHT,x.LEFT_RIGHT]}static get CENTER(){return{doors:{top:!0,bottom:!0,left:!0,right:!0},tiles:[[1,1,1,1,0,0,1,1,1,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,1,1,1,0,0,1,1,1,1]]}}static get LEFT(){return{doors:{top:!1,bottom:!1,left:!0,right:!1},tiles:[[1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[0,0,0,0,0,0,0,0,0,1],[0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1]]}}static get RIGHT(){return{doors:{top:!1,bottom:!1,left:!1,right:!0},tiles:[[1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1]]}}static get TOP(){return{doors:{top:!0,bottom:!1,left:!1,right:!1},tiles:[[1,1,1,1,0,0,1,1,1,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1]]}}static get BOTTOM(){return{doors:{top:!1,bottom:!0,left:!1,right:!1},tiles:[[1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,1,1,1,0,0,1,1,1,1]]}}static get TOP_LEFT(){return{doors:{top:!0,bottom:!1,left:!0,right:!1},tiles:[[1,1,1,1,0,0,1,1,1,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[0,0,0,0,0,0,0,0,0,1],[0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1]]}}static get TOP_RIGHT(){return{doors:{top:!0,bottom:!1,left:!1,right:!0},tiles:[[1,1,1,1,0,0,1,1,1,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1]]}}static get TOP_BOTTOM(){return{doors:{top:!0,bottom:!0,left:!1,right:!1},tiles:[[1,1,1,1,0,0,1,1,1,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,1,1,1,0,0,1,1,1,1]]}}static get BOTTOM_LEFT(){return{doors:{top:!1,bottom:!0,left:!0,right:!1},tiles:[[1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[0,0,0,0,0,0,0,0,0,1],[0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,1,1,1,0,0,1,1,1,1]]}}static get BOTTOM_RIGHT(){return{doors:{top:!1,bottom:!0,left:!1,right:!0},tiles:[[1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,1,1,1,0,0,1,1,1,1]]}}static get LEFT_RIGHT(){return{doors:{top:!1,bottom:!1,left:!0,right:!0},tiles:[[1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1]]}}}class y{static NONE=-1;static FLOOR=0;static WALL=1;constructor(t=128){this.size=t,this.reset()}setTile(t,e,s){void 0!==this.map[t]&&void 0!==this.map[t][e]&&(this.map[t][e]=s)}getTile(t,e){return this.map[t]&&this.map[t][e]}setSpawn(t,e){this.spawnX=t,this.spawnY=e}registerComponents(t){this.map.forEach(((e,s)=>{e.forEach(((e,i)=>{e!==y.WALL?e===y.FLOOR&&t.spawn(m.create(s,i)):t.spawn(w.create(s,i))}))}))}reset(){this.map=Array(this.size).fill(0).map((()=>Array(this.size).fill(0).map((()=>y.NONE))))}}class I{constructor(){this.entities=[],this.entitiesToDraw=[]}init(t){this.map=class{static generate(t=128){const e=new y(t);return this.generateRooms(e),e}static generateRooms(t){Array(2).fill(0).map((()=>Array(2)));const e=[{x:Math.round(t.size/2)-5,y:Math.round(t.size/2)-5,direction:null}],s=[Object.values(e[0]).join(",")];for(t.setSpawn(e[0].x+5,e[0].y+5);e.length>0;){const{x:i,y:r,direction:o}=e.shift();if(s.includes([i,r].join(",")))continue;const n=o?x.getRandomRoom(o):x.CENTER;this.placeRoom(i,r,n,t),s.push([i,r].join(",")),n.doors.top&&e.push({x:i,y:r-9,direction:"bottom"}),n.doors.bottom&&e.push({x:i,y:r+9,direction:"top"}),n.doors.left&&e.push({x:i-9,y:r,direction:"right"}),n.doors.right&&e.push({x:i+9,y:r,direction:"left"})}}static placeRoom(t,e,s,i){for(let r=0;r<10;r++)for(let o=0;o<10;o++){const n=0===s.tiles[o][r]?y.FLOOR:y.WALL;i.setTile(t+r,e+o,n)}}}.generate(120),this.map.registerComponents(this);const{spawnX:e,spawnY:s}=this.map;this.player=T.create("Vornian"),this.spawn(this.player,e,s)}render(t,e){this.entitiesToDraw.forEach((s=>{E.for(s).render(t,e)})),this.entitiesToDraw=[]}update(t,e,s){this.entities.forEach((i=>{f.for(i).shouldRun()?.update?.(t,e,s),i.isDrawable()&&this.draw(i)}))}spawn(t,e,s){if(void 0!==e&&void 0!==s){t.get("Placeable")?.set?.(e,s)}this.entities[t.id]=t}getPlayer(){return this.player}draw(t){this.entitiesToDraw.push(t)}}const L=document.getElementById("canvas");new class{constructor(e){this.canvas=t.fromHTMLCanvas(e),this.ctx=e.getContext("2d"),this.ctx.imageSmoothingEnabled=!0,this.ctx.imageSmoothingQuality="high"}init(t){this.game=t,this.graphics=new e(this.canvas,this.ctx),this.game.init(this.canvas),this.requestAnimationFrame()}gameLoop(){this.game.update(this.input,1,this.canvas),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.game.render(this.canvas,this.graphics),this.requestAnimationFrame()}requestAnimationFrame(){window.requestAnimationFrame(this.gameLoop.bind(this))}}(L).init(new class{constructor(){this.world=new I,this.camera=new i}init(t){console.log("Game init."),this.world.init(t),t.useCamera(this.camera),this.camera.follow(this.world.getPlayer())}render(t,e){this.world.render(t,e)}update(t,e,s){this.world.update(t,e,s),this.camera.update(t,e,s)}});
//# sourceMappingURL=index.8e2c59ba.js.map
